(function(){"use strict";angular.module("workorderInvasionApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/invasion",{templateUrl:"views/invasion.html",controller:"InvasionCtrl"}).when("/gameover",{templateUrl:"views/gameover.html",controller:"GameoverCtrl"}).when("/start",{templateUrl:"views/start.html",controller:"StartCtrl"}).otherwise({redirectTo:"/"})}])}).call(this),function(){"use strict";angular.module("workorderInvasionApp").controller("MainCtrl",["$scope","$location","player",function(a,b,c){return a.players=c.getPlayers()}])}.call(this),function(){"use strict";angular.module("workorderInvasionApp").controller("InvasionCtrl",["$scope","player","$location",function(a,b){var c;return a.secondsTilStart=5,a.gameReady=function(){return 0===a.secondsTilStart?!0:!1},c=window.setInterval(function(){return a.$apply(function(){return a.secondsTilStart--}),0===a.secondsTilStart?(window.clearInterval(c),Game.init()):void 0},1e3),b.getPlayer(),a.setScore=function(a){return b.setScore(a)}}])}.call(this),function(){var a,b,c,d,e,f,g;window.Game={ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",width:500,runGame:function(){return g.init(),f.init(),e.init(),a.init(),c.init(),b.init(),g.gamestart.play(),this.updateHandler=window.setInterval(Game.update,20)},init:function(){return this.welcome=document.getElementById("welcomeScreen"),this.restart=document.getElementById("gameoverScreen"),this.board=document.getElementById("invasion"),this.runGame()},update:function(){return f.update(),d.update()},elRemove:function(a){var b,c,d,e,f,g,h,i;for(d=a.split(" "),i=[],g=0,h=d.length;h>g;g++)c=d[g],f=c.charAt(0),e=c.slice(1),b="."===f?document.getElementsByClassName(e):document.getElementById(e),i.push("."===f?function(){var a;for(a=[];b[0];)a.push(b[0].parentNode.removeChild(b[0]));return a}():"object"==typeof b&&null!==b?this.board.removeChild(b):void 0);return i},endGame:function(){var d,e,f,h;return a.cancelGamepad(),g.gameover.play(),window.clearInterval(b.timer),window.removeEventListener("keydown",a.keyDown,!0),window.removeEventListener("keyup",a.keyUp,!0),window.clearInterval(this.updateHandler),h=angular.element("#invasion"),f=h.scope(),f.setScore(c.score),d=h.injector(),e=d.get("$location"),e.path("/gameover"),f.$apply()}},f={init:function(){return this.x=220,this.y=460,this.width=35,this.height=35,this.speed=3,this.build(this.x,this.y,"player active")},build:function(a,b,c){var d;return d=document.createElementNS(Game.ns,"image"),d.setAttribute("class",c),d.setAttribute("x",a),d.setAttribute("y",b),d.setAttribute("width",this.width),d.setAttribute("height",this.height),d.setAttributeNS(Game.xlink,"xlink:href","images/ship.svg"),Game.board.appendChild(d),this.player=document.getElementsByClassName("player")},update:function(){return a.left&&this.x>=0?this.x-=this.speed:a.right&&this.x<=Game.width-this.width&&(this.x+=this.speed),this.player[0]?this.player[0].setAttribute("x",this.x):void 0},collide:function(){return g.playerexplosion.play(),c.lives-=1,Game.board.removeChild(this.player[0]),Game.board.removeChild(this.lives[c.lives]),c.lives>0?window.setTimeout(function(){return f.build(f.x,f.y,"player active")},1e3):Game.endGame()}},a={init:function(){return this.left=!1,this.right=!1,window.addEventListener("keydown",this.keyDown,!0),window.addEventListener("keyup",this.keyUp,!0),this.lastFrame&&window.cancelAnimationFrame(this.lastFrame),this.lastFrame=window.requestAnimationFrame(a.updateGamepad)},keyDown:function(b){var c,e;switch(b.keyCode){case 39:return a.right=!0;case 37:return a.left=!0;case 32:return g.laser.play(),c=document.getElementsByClassName("negative"),e=document.getElementsByClassName("player"),d.build(f.x+f.width/2-d.width,f.y-d.height,!0)}},keyUp:function(b){switch(b.keyCode){case 39:return a.right=!1;case 37:return a.left=!1}},updateGamepad:function(){var b;return a.id=window.requestAnimationFrame(a.updateGamepad),b=navigator.getGamepads()[0],void 0!==b?(b.buttons[4].pressed&&!a.fire?(g.laser.play(),a.fire=!0,d.build(f.x+f.width/2-d.width,f.y-d.height,!0)):!b.buttons[4].pressed&&a.fire&&(a.fire=!1),b.buttons[15].pressed?a.right=!0:b.buttons[14].pressed?a.left=!0:(a.left=!1,a.right=!1)):void 0},cancelGamepad:function(){return window.cancelAnimationFrame(this.id)}},e={init:function(){var a,b,c,d;for(this.x=64,this.y=390,this.hp=3,this.size=15,d=[],a=c=3;c>=0;a=--c)d.push(function(){var c,d;for(d=[],b=c=7;c>=0;b=--c)d.push(this.build(a,b));return d}.call(this));return d},build:function(a,b){var c,d;return d=this.x+a*this.x+3*a*this.size,c=document.createElementNS(Game.ns,"rect"),c.setAttribute("x",this.locX(b,d)),c.setAttribute("y",this.locY(b)),c.setAttribute("class","shield active"),c.setAttribute("hp",this.hp),c.setAttribute("width",this.size),c.setAttribute("height",this.size),Game.board.appendChild(c)},locX:function(a,b){switch(a){case 0:return b;case 1:return b;case 2:return b;case 3:return b+this.size;case 4:return b+this.size;case 5:return b+2*this.size;case 6:return b+2*this.size;case 7:return b+2*this.size}},locY:function(a){switch(a){case 0:return this.y;case 1:return this.y+this.size;case 2:return this.y+2*this.size;case 3:return this.y;case 4:return this.y+this.size;case 5:return this.y;case 6:return this.y+this.size;case 7:return this.y+2*this.size}},collide:function(a){var b,c;switch(b=parseInt(a.getAttribute("hp"),10)-1){case 1:c=.33;break;case 2:c=.66;break;default:return Game.board.removeChild(a)}return a.setAttribute("hp",b),a.setAttribute("fill-opacity",c)}},d={speed:8,width:2,height:10,build:function(a,b,c){var d;return d=document.createElementNS(Game.ns,"rect"),c?d.setAttribute("class","laser negative"):d.setAttribute("class","laser"),d.setAttribute("x",a),d.setAttribute("y",b),d.setAttribute("width",this.width),d.setAttribute("height",this.height),Game.board.appendChild(d)},direction:function(a,b){var c;return c="laser negative"===b?-this.speed:this.speed,a+=c},collide:function(a){return void 0!==a?Game.board.removeChild(a):void 0},update:function(){var a,c,d,g,h,i,j,k,l,m,n,o,p,q,r;if(n=document.getElementsByClassName("laser"),n.length)for(a=document.getElementsByClassName("active"),o=0,q=n.length;q>o;o++)for(k=n[o],l=parseInt(k.getAttribute("x"),10),m=parseInt(k.getAttribute("y"),10),Game.height<l&&0>l?this.collide(k):(m=this.direction(m,k.getAttribute("class")),k.setAttribute("y",m)),p=0,r=a.length;r>p;p++){if(j=a[p],void 0===j)return;h=parseInt(j.getAttribute("x"),10)||f.x,i=parseInt(j.getAttribute("y"),10)||f.y,g=parseInt(j.getAttribute("width"),10)||f.width,d=parseInt(j.getAttribute("height"),10)||f.height,l+this.width>=h&&h+g>=l&&m+this.height>=i&&i+d>=m&&(this.collide(k),c=j.getAttribute("class"),"enemy active"===c?b.collide(j):"shield active"===c?e.collide(j):f.player[0]&&f.collide())}}},c={livesX:360,livesY:10,livesGap:10,init:function(){var a,b,d,e;for(this.score=0,this.lives=3,this.level=1,a=d=1,e=c.lives;e>=1?e>=d:d>=e;a=e>=1?++d:--d)b=this.livesX+f.width*a+this.livesGap*a,f.build(b,this.livesY,"life");return this.build("Lives:",310,30,"textLives"),this.build("Score: 0",20,30,"textScore"),f.lives=document.getElementsByClassName("life")},build:function(a,b,c,d){var e;return e=document.createElementNS(Game.ns,"text"),e.setAttribute("x",b),e.setAttribute("y",c),e.setAttribute("id",d),e.setAttribute("fill","#fff"),e.appendChild(document.createTextNode(a)),Game.board.appendChild(e)},updateScore:function(a){var b,c;return this.score+=a,this.bonus+=a,b=document.getElementById("textScore"),b.replaceChild(document.createTextNode("Score: "+this.score),b.firstChild),this.bonus<100||3===this.lives?void 0:(c=this.livesX+f.width*this.lives+this.livesGap*this.lives,f.build(c,this.livesY,"life"),this.lives+=1,this.bonus=0)},levelUp:function(){var a;return b.counter+=1,a=b.col*b.row,b.counter===a?(this.level+=1,b.counter=0,window.clearInterval(b.timer),Game.board.removeChild(b.flock),setTimeout(function(){return b.init()},300)):b.counter===Math.round(a/2)?(b.delay-=100,window.clearInterval(b.timer),b.timer=window.setInterval(b.update,b.delay)):b.counter===b.col*b.row-10?(b.delay-=200,window.clearInterval(b.timer),b.timer=window.setInterval(b.update,b.delay)):void 0}},b={width:25,height:19,x:64,y:90,gap:10,row:5,col:10,init:function(){return this.speed=10,this.counter=0,this.build(),this.delay=600-20*c.level,this.timer&&window.clearInterval(this.update,this.delay),this.timer=window.setInterval(this.update,this.delay)},build:function(){var a,b,c,d,e,f,g,h,i;for(d=document.createElementNS(Game.ns,"g"),d.setAttribute("class","open"),d.setAttribute("id","flock"),c=["faucet","heater","mouse","toilet","window"],e=f=h=this.row;0>=h?0>f:f>0;e=0>=h?++f:--f)for(a=g=i=this.col;0>=i?0>g:g>0;a=0>=i?++g:--g)b=document.createElementNS(Game.ns,"image"),b.setAttribute("x",this.locX(a)),b.setAttribute("y",this.locY(e)),b.setAttribute("class","enemy active"),b.setAttribute("row",e),b.setAttribute("col",a),b.setAttribute("width",this.width),b.setAttribute("height",this.height),b.setAttributeNS(Game.xlink,"xlink:href","images/"+c[e-1]+".svg"),d.appendChild(b);return Game.board.appendChild(d),this.flock=document.getElementById("flock")},locX:function(a){return this.x+a*this.width+a*this.gap},locY:function(a){return this.y+a*this.height+a*this.gap},update:function(){var a,c,d,f,g,h,i,j,k,l,m,n,o;if(a=document.getElementsByClassName("enemy"),0!==a.length){for(d=this.flock.getBBox(),g=Math.round(d.width),f=Math.round(d.height),h=Math.round(d.x),i=Math.round(d.y),j=0,k=0,g+h+b.speed>=Game.width||h+b.speed<=0?(k=Math.abs(b.speed),b.speed*=-1):j=b.speed,n=0,o=a.length;o>n;n++)c=a[n],l=parseInt(c.getAttribute("x"),10)+j,m=parseInt(c.getAttribute("y"),10)+k,c.setAttribute("x",l),c.setAttribute("y",m);return i+f>=e.y&&Game.endGame(),b.shoot(a,i+f-b.height)}},collide:function(a){return g.enemyexplosion.play(),c.updateScore(1),c.levelUp(),a.parentNode.removeChild(a)},shoot:function(a,b){var c,e,f,g,h,i;if(!(Math.floor(5*Math.random())<2)){for(g=[],h=0,i=a.length;i>h;h++)e=a[h],c=parseInt(e.getAttribute("y"),10),c>=b&&g.push(e);return f=Math.floor(Math.random()*g.length),d.build(parseInt(g[f].getAttribute("x"),10)+this.width/2,b+this.height+10,!1)}}},g={init:function(){return this.enemyexplosion=new Audio("/workorder-invasion/sounds/enemyexplosion.wav"),this.gameover=new Audio("/workorder-invasion/sounds/gameover.wav"),this.gamestart=new Audio("/workorder-invasion/sounds/gamestart.wav"),this.laser=new Audio("/workorder-invasion/sounds/laser.wav"),this.playerexplosion=new Audio("/workorder-invasion/sounds/playerexplosion.wav")}}}.call(this),function(){"use strict";angular.module("workorderInvasionApp").controller("GameoverCtrl",["$scope","player",function(a,b){return a.score=b.getScore()}])}.call(this),function(){"use strict";angular.module("workorderInvasionApp").factory("player",["$location",function(a){var b,c;return c="player",b="",{savePlayer:function(d){var e,f;return f=Math.round((new Date).getTime()),e=c+f,d=JSON.stringify(d),localStorage[e]=d,b=e,a.path("/invasion")},setScore:function(a){var c;return c=localStorage[b],c=JSON.parse(c),c.score=a,localStorage[b]=JSON.stringify(c)},getScore:function(){var a;return a=localStorage[b],a=JSON.parse(a),a.score},getPlayer:function(){return b?void 0:a.path("/start")},getPlayers:function(){var a,b;return a=[],b=c.length,Object.keys(localStorage).forEach(function(d){var e;return d.substring(0,b)===c&&(e=localStorage[d],e=JSON.parse(e),e.score)?a.push(e):void 0}),a}}}])}.call(this),function(){"use strict";angular.module("workorderInvasionApp").controller("StartCtrl",["$scope","player",function(a,b){return a.play=function(){return b.savePlayer(a.player)}}])}.call(this),function(){"use strict";angular.module("workorderInvasionApp").controller("FullscreenCtrl",["$scope",function(a){return a.fullscreen=function(){return document.documentElement.webkitRequestFullscreen()}}])}.call(this);